Ext.define("Ext.azure.AuthWindow",{singleton:true,requires:["Ext.Ajax"],window:null,intervalId:null,scopedMessageFn:null,create:function(a){this.window=window.open(a,"_blank","location=no");if(Ext.browser.is.WebView){this.window.addEventListener("loadstart",this.urlChangeHandler);this.window.addEventListener("exit",this.exitHandler)}else{window.addEventListener("message",this.messageHandler)}this.intervalId=window.setInterval(this.intervalFn,250)},intervalFn:function(){var a=Ext.azure.AuthWindow;if(a.window&&a.window.closed===true){a.endRequest("setInterval() detected the authentication window was closed manually.")}},endRequest:function(c,b){var a=this.window;window.clearInterval(this.intervalId);if(a){if(Ext.browser.is.WebView){a.removeEventListener("loadstart",this.urlChangeHandler);a.removeEventListener("exit",this.exitHandler)}else{window.removeEventListener("message",this.messageHandler)}a.close()}if(!c){Ext.azure.Authentication.onAuthSuccess(b)}else{Ext.azure.Authentication.onAuthFailure(c)}},messageHandler:function(d){var c=Ext.azure.AuthWindow,a;if(d.source===c.window){try{if(d.data==="__ready__"){return}a=Ext.JSON.decode(d.data)}catch(b){c.endRequest("An error occurred decoding the response.");return}if(a.type==="LoginCompleted"){c.endRequest(false,{id:a.oauth.user.userId,token:a.oauth.authenticationToken})}if(a.error){c.endRequest(a.error)}}},urlChangeHandler:function(c){var a=c.url,e=a.indexOf("#");if(e<0){return false}var d=Ext.Object.fromQueryString(a.slice(e+1));if(d.token){var b=Ext.JSON.decode(d.token);Ext.azure.AuthWindow.endRequest(false,{id:b.user.userId,token:b.authenticationToken});return true}return false},exitHandler:function(){Ext.azure.AuthWindow.endRequest("exitHandler() detected the authentication window was closed manually.")}});Ext.define("Ext.azure.Authentication",{singleton:true,requires:["Ext.azure.AuthWindow"],localStorageId:"azure-user-",loginUrl:"login/",user:null,init:function(){this.localStorageId+=Ext.Azure.getAppKey();Ext.azure.User.getProxy().setId(this.localStorageId);this.getCurrentUser()},getCurrentUser:function(){if(this.user){return this.user}var a=localStorage.getItem(this.localStorageId);if(a){Ext.azure.User.load(a,{scope:this,failure:function(b,c){Ext.azure.User.getProxy().clear();Ext.Azure.fireEvent("authenticationfailure")},success:function(b){this.user=b;Ext.Azure.fireEvent("authenticationsuccess")}});return true}return false},setCurrentUser:function(a){var b=this.user;if(!b){b=Ext.create("Ext.azure.User")}if(b.setData){b.setData({id:a.id,token:a.token})}else{b.set("id",a.id);b.set("token",a.token)}b.save();this.user=b},login:function(a){Ext.azure.AuthWindow.create(this.buildAuthUrl(a))},logout:function(){this.user.getProxy().clear();this.user.destroy();this.user=null;Ext.Azure.fireEvent("authenticationlogout")},onAuthSuccess:function(a){this.setCurrentUser(a);Ext.Azure.fireEvent("authenticationsuccess")},onAuthFailure:function(a){this.user=null;Ext.Azure.fireEvent("authenticationfailure",a)},getLoginUrl:function(){return Ext.Azure.buildDomainUrl()+this.loginUrl},buildAuthUrl:function(c){var b=this.getLoginUrl(),a=window.location.origin;if(/file:/.test(a)){a="http://localhost"}switch(c){case"facebook":b+="facebook";break;case"twitter":b+="twitter";break;case"google":b+="google";break;case"microsoftaccount":b+="microsoftaccount";break}if(Ext.browser.is.WebView){return b}b=Ext.urlAppend(b,Ext.Object.toQueryString({mode:"authenticationToken",completion_type:"postMessage",completion_origin:a}));return b}});Ext.define("Ext.azure.Filter",{extend:"Ext.util.Filter",config:{operator:"eq",chainOperator:""}});Ext.define("Ext.azure.Proxy",{extend:"Ext.data.proxy.Ajax",requires:["Ext.azure.Filter","Ext.util.MixedCollection","Ext.Ajax"],alias:"proxy.azure",alternateClassName:"Ext.data.AzureProxy",config:{appendId:true,batchActions:false,actionMethods:{create:"POST",read:"GET",update:"PATCH",destroy:"DELETE"},selectParam:"$select",orderParam:"$orderby",filterParam:"$filter",startParam:"$skip",limitParam:"$top",groupParam:null,sortParam:"$orderby",pageParam:null,protocol:"https",tableName:null,customApiName:null,enablePagingParams:true,timeout:30000,extraParams:{"$inlinecount":"allpages"},headers:{Accept:"*/*","Content-Type":"application/json"},reader:{type:"json",implicitIncludes:false,rootProperty:"results",totalProperty:"count"},writer:{type:"json"},url:"/",noCache:false,useHeaderAuthentication:false},initialize:function(){this.callParent();this.on("exception",this.onProxyExceptionHandler)},onProxyExceptionHandler:function(d,b,a,c){if(b.status===401){Ext.Azure.fireEvent("authenticationfailure",{message:"Ext.azure.Proxy failed to load a resource because it requires authorization."})}},doRequest:function(d,i,j){var h=this,f,b=h.getWriter(),c=d.getAction(),e=h.buildRequest(d),a=Ext.applyIf(Ext.Azure.getDefaultHeaders(),h.getHeaders());if(h.getUseHeaderAuthentication()){var g=Ext.azure.Authentication.getCurrentUser();if(typeof g!=="boolean"){a["X-ZUMO-AUTH"]=g.get("token")}}e.setConfig({headers:a,timeout:h.getTimeout(),method:h.getMethod(e),callback:h.createRequestCallback(e,d,i,j),scope:h,proxy:h});e=b.write(e);if(c==="create"){f=e.getJsonData();delete f.id;e.setJsonData(f)}Ext.Ajax.request(e.getCurrentConfig());return e},buildUrl:function(f){var j=this,e=f.getOperation(),c=e.getRecords()||[],i=c[0],h=j.getModel(),n=(h.getIdProperty?h.getIdProperty():h.idProperty),a=j.getUrl(f),d=f.getParams()||{},b=(i&&!i.phantom)?i.getId():d[n],m=Ext.Azure.getAppUrl();if(j.getAppendId()&&b){if(!a.match(/\/$/)){a+="/"}a+=b}var l=this.getTableName(),g=this.getCustomApiName(),k;if(l!==null){k=Ext.Azure.buildDomainUrl()+"tables/"+l}else{if(g!==null){k=Ext.Azure.buildDomainUrl()+"api/"+g}}f.setUrl(k+a);return j.callParent([f])},processResponse:function(e,b,d,a,f,c){if(b.getAction()==="create"){a.responseText="["+a.responseText+"]"}this.callParent(arguments)},getParams:function(k){var t=this,q,u,n,s={},a=k.getSorters(),j=k.getFilters(),g=k.getPage(),e=k.getStart(),r=k.getLimit(),m=t.getPageParam(),c=t.getStartParam(),b=t.getLimitParam(),d=t.getSortParam(),l=t.getFilterParam();if(t.getEnablePagingParams()){if(m&&g!==null){s[m]=g}if(c&&e!==null){s[c]=e}if(b&&r!==null){s[b]=r}}if(d&&a&&a.length>0){s[d]=a[0].getProperty()+" "+a[0].getDirection().toLowerCase()}if(l&&j&&j.length>0){var h=[],o=0,p=j.length;for(o;o<p;o++){q=j[o];u=q.getProperty()+" "+q.getOperator()+" "+q.getValue();n=q.getChainOperator()===""?"":" "+q.getChainOperator()+" ";h.push(u+n)}s[l]=h.join("")}return s}});Ext.define("Ext.azure.storage.Abstract",{requires:["Ext.Date"],config:{accountName:"",accessKey:"",msVersion:"2012-02-12",storageType:""},constructor:function(a){this.initConfig(a)},xmlDocumentTpl:{storageService:['<?xml version="1.0" encoding="utf-8"?>',"<StorageServiceProperties>","    <Logging>","        <Version>{logging.version}</Version>","        <Delete>{logging.delete}</Delete>","        <Read>{logging.read}</Read>","        <Write>{logging.write}</Write>","        <RetentionPolicy>","            <Enabled>{logging.retentionPolicy.enabled}</Enabled>","            <Days>{logging.retentionPolicy.days}</Days>","        </RetentionPolicy>","    </Logging>","    <Metrics>","        <Version>{metrics.version}</Version>","        <Enabled>{metrics.enabled}</Enabled>","        <IncludeAPIs>{metrics.includeApis}</IncludeAPIs>","        <RetentionPolicy>","            <Enabled>{metrics.retentionPolicy.enabled}</Enabled>","            <Days>{metrics.retentionPolicy.days}</Days>","        </RetentionPolicy>","    </Metrics>","</StorageServiceProperties>"],acl:['<?xml version="1.0" encoding="utf-8"?>',"<SignedIdentifiers>","    <SignedIdentifier>","        <Id>{id}</Id>","        <AccessPolicy>","            <Start>{accessPolicy.start}</Start>","            <Expiry>{accessPolicy.expiry}</Expiry>","            <Permission>{accessPolicy.permission}</Permission>","        </AccessPolicy>","    </SignedIdentifier>","</SignedIdentifiers>"],item:['<?xml version="1.0" encoding="utf-8" standalone="yes"?>','<entry xmlns="http://www.w3.org/2005/Atom" ','       xmlns:d="http://schemas.microsoft.com/ado/2007/08/dataservices" ','       xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata">',"    <updated>{updated}</updated>","    {[ this.renderId(values.id) ]}",'    <content type="application/xml">',"        <m:properties>",'            <tpl for="properties">{[ this.renderProperty(values) ]}</tpl>',"        </m:properties>","    </content>","</entry>",{renderProperty:function(a){var b=a.type;if(!b){b="Edm.String"}return"<d:"+a.key+' m:type="'+b+'">'+a.value+"</d:"+a.key+">"},renderId:function(a){if(a){return"<id>"+a+"</id>"}return""}}],blocklist:['<?xml version="1.0" encoding="utf-8"?>',"<BlockList>",'    <tpl for="properties">',"    {[ this.renderProperty(values) ]}","    </tpl>","</BlockList>",{renderProperty:function(a){return"<"+a.key+">"+window.btoa(a.value)+"</"+a.key+">"}}]},_getDomain:function(b){var a=(b)?"":":443";return"https://"+this.getAccountName()+"."+this.getStorageType()+".core.windows.net"+a},_formatRequestUrl:function(a,b){return Ext.String.urlAppend(this._getDomain()+a,Ext.Object.toQueryString(b))},_formatCanonicalResource:function(a,b){return"/"+this.getAccountName()+a+this._normalizeAuthHeaderParams(b)},_formatCanonicalizedHeaders:function(c){var a="";if(c){var b=[];Ext.Object.each(c,function(d){if(d.indexOf("x-ms-")===0){b.push(d)}});b.sort();Ext.each(b,function(d){a+=d.toLowerCase()+":"+c[d]+"\n"})}return a},_formatStringToSign:function(a,b){if(this.getStorageType()==="table"){return b.headers["x-ms-date"]+"\n"+a}return b.method+"\n"+(b.headers["Content-MD5"]||"")+"\n"+b.headers["Content-Type"]+"\n"+b.headers.Date+"\n"+this._formatCanonicalizedHeaders(b.headers)+a},_encryptSignature:function(b){var a=CryptoJS.HmacSHA256(unescape(encodeURIComponent(b)),CryptoJS.enc.Base64.parse(this.getAccessKey())).toString(CryptoJS.enc.Base64);return"SharedKeyLite "+this.getAccountName()+":"+a},_encodeAuthHeader:function(a,e,b){var c=this._formatCanonicalResource(a,e),d=this._formatStringToSign(c,b);b.headers.Authorization=this._encryptSignature(d);return b},_normalizeAuthHeaderParams:function(b){var a="";if(b.comp){a+="?comp="+b.comp}return a},_formatRequest:function(e,b,f,a){if(!e.headers){e.headers={}}if(!a){a=new Date()}e.headers=Ext.apply({"x-ms-date":a.toUTCString(),Date:"","x-ms-version":this.getMsVersion(),accept:"*/*","Accept-Charset":"UTF-8",host:this.getAccountName()+"."+this.getStorageType()+".core.windows.net:443",Origin:"","X-ZUMO-VERSION":Ext.Azure.getUserAgentString(),dataserviceversion:"1.0;NetFx",maxdataserviceversion:"2.0;NetFx"},e.headers);if(e.xmlData!==undefined){e.headers=Ext.apply({"Content-Type":(e.xmlData.length===0)?"":"application/atom+xml","Content-Length":e.xmlData.length},e.headers)}else{if(e.binaryData!==undefined){var d,c;if(e.binaryData instanceof Blob){d=e.binaryData.size;c=e.binaryData.type}else{d=e.binaryData.length;c="application/octet-stream"}e.headers=Ext.apply({"Content-Type":c,"Content-Length":d},e.headers)}}Ext.Object.each(e.headers,function(h,g){if(g===undefined){delete e.headers[h]}});return this._encodeAuthHeader(b,f,e)},_applyXmlDocumentTpl:function(c,b){if(!b){return""}if(!c){return b}var a=Ext.create("Ext.XTemplate",c);return a.apply(b)},_sendRequest:function(a){Ext.Ajax.request(Ext.apply(a,{disableCaching:false,useDefaultXhrHeader:false,withCredentials:true}))},getStorageServiceProperties:function(g,b){var c="/",h="GET",f={restype:"service",comp:"properties"};var a=this._formatRequestUrl(c,f);var e="";var d=this._formatRequest({url:a,method:h,headers:{"x-ms-version":this.getMsVersion()},xmlData:e,success:g,failure:b},c,f);this._sendRequest(d)},setStorageServiceProperties:function(h,i,d){var c="/",a="PUT",e={restype:"service",comp:"properties"};var b=this._formatRequestUrl(c,e);var g=this._applyXmlDocumentTpl(this.xmlDocumentTpl.storageService,h);var f=this._formatRequest({url:b,method:a,headers:{"x-ms-version":"2011-08-18"},xmlData:g,success:i,failure:d},c,e);this._sendRequest(f)}});Ext.define("Ext.azure.storage.Table",{extend:"Ext.azure.storage.Abstract",config:{storageType:"table"},_getEntityPath:function(a){return"/"+a.name+"(PartitionKey='"+a.partitionKey+"',RowKey='"+a.row+"')"},queryTables:function(g,f,b){var c="/Tables",h="GET";var a=this._formatRequestUrl(c,g);var e="";var d=this._formatRequest({url:a,method:h,xmlData:e,headers:{"x-ms-version":undefined},success:f,failure:b},c,g);this._sendRequest(d)},createTable:function(i,j,d){var c="/Tables",a="POST",f={},e=new Date();i=Ext.apply(i,{updated:e.toISOString()});var b=this._formatRequestUrl(c,f);var h=this._applyXmlDocumentTpl(this.xmlDocumentTpl.item,i);var g=this._formatRequest({url:b,method:a,headers:{"x-ms-version":"2011-08-18"},xmlData:h,success:j,failure:d},c,f,e);this._sendRequest(g)},deleteTable:function(i,h,d){var c="/Tables('"+i.name+"')",a="DELETE",e={};var b=this._formatRequestUrl(c,e);var g="";var f=this._formatRequest({url:b,method:a,headers:{"x-ms-version":undefined},xmlData:g,success:h,failure:d},c,e);this._sendRequest(f)},getTableAcl:function(i,h,d){var c="/"+i.name,a="GET",e={comp:"acl"};var b=this._formatRequestUrl(c,e);var g="";var f=this._formatRequest({url:b,method:a,xmlData:g,success:h,failure:d},c,e);this._sendRequest(f)},setTableAcl:function(j,h,i,d){var c="/"+j.name,a="PUT",e={comp:"acl"};var b=this._formatRequestUrl(c,e);var g=this._applyXmlDocumentTpl(this.xmlDocumentTpl.acl,h);var f=this._formatRequest({url:b,method:a,xmlData:g,success:i,failure:d},c,e);this._sendRequest(f)},queryEntities:function(i,h,d){var c="/"+i.name,a="GET",e={};var b=this._formatRequestUrl(c,e);var g="";var f=this._formatRequest({url:b,method:a,xmlData:g,headers:{"x-ms-version":undefined},success:h,failure:d},c,e);this._sendRequest(f)},insertEntity:function(k,i,j,d){var c="/"+k.name,a="POST",f={},e=new Date();i=Ext.apply(i,{updated:e.toISOString()});var b=this._formatRequestUrl(c,f);var h=this._applyXmlDocumentTpl(this.xmlDocumentTpl.item,i);var g=this._formatRequest({url:b,method:a,headers:{"x-ms-version":"2011-08-18"},xmlData:h,success:j,failure:d},c,f,e);this._sendRequest(g)},insertOrMergeEntity:function(k,i,j,d){var c=this._getEntityPath(k),a="MERGE",f={},e=new Date();i=Ext.apply(i,{updated:e.toISOString()});var b=this._formatRequestUrl(c,f);var h=this._applyXmlDocumentTpl(this.xmlDocumentTpl.item,i);var g=this._formatRequest({url:b,method:a,headers:{"x-ms-version":"2011-08-18"},xmlData:h,success:j,failure:d},c,f,e);this._sendRequest(g)},insertOrReplaceEntity:function(k,i,j,d){var c=this._getEntityPath(k),a="PUT",f={},e=new Date();i=Ext.apply(i,{updated:e.toISOString()});var b=this._formatRequestUrl(c,f);var h=this._applyXmlDocumentTpl(this.xmlDocumentTpl.item,i);var g=this._formatRequest({url:b,method:a,headers:{"x-ms-version":"2011-08-18"},xmlData:h,success:j,failure:d},c,f,e);this._sendRequest(g)},updateEntity:function(k,i,j,d){var c=this._getEntityPath(k),a="PUT",f={},e=new Date();i=Ext.apply(i,{updated:e.toISOString()});var b=this._formatRequestUrl(c,f);var h=this._applyXmlDocumentTpl(this.xmlDocumentTpl.item,i);var g=this._formatRequest({url:b,method:a,headers:{"x-ms-version":"2011-08-18","If-Match":"*"},xmlData:h,success:j,failure:d},c,f,e);this._sendRequest(g)},mergeEntity:function(k,i,j,d){var c=this._getEntityPath(k),a="MERGE",f={},e=new Date();i=Ext.apply(i,{updated:e.toISOString()});var b=this._formatRequestUrl(c,f);var h=this._applyXmlDocumentTpl(this.xmlDocumentTpl.item,i);var g=this._formatRequest({url:b,method:a,headers:{"x-ms-version":"2011-08-18","If-Match":"*"},xmlData:h,success:j,failure:d},c,f,e);this._sendRequest(g)},deleteEntity:function(i,h,d){var c=this._getEntityPath(i),a="DELETE",e={};var b=this._formatRequestUrl(c,e);var g="";var f=this._formatRequest({url:b,method:a,headers:{"If-Match":"*","x-ms-version":"2011-08-18"},xmlData:g,success:h,failure:d},c,e);this._sendRequest(f)}});Ext.define("Ext.azure.storage.Blob",{extend:"Ext.azure.storage.Abstract",config:{storageType:"blob"},_isBlob:function(a){return(a instanceof Blob||a instanceof Array)},_setRangeHeader:function(d,c,b){var a="";if(c>=0){a="bytes="+c+"-"}if(a!==""&&b>=0){a+=b}if(a!==""){Ext.apply(d,{"x-ms-range":a})}return d},_setLeaseHeaders:function(a,b){Ext.apply(b,{"x-ms-lease-action":a.operation});if(a.leaseId!==undefined){b["x-ms-lease-id"]=a.leaseId}if(a.leaseBreakPeriod!==undefined){b["x-ms-lease-break-period"]=a.leaseBreakPeriod}if(a.leaseDuration!==undefined){b["x-ms-lease-duration"]=a.leaseDuration}if(a.proposedLeaseId!==undefined){b["x-ms-proposed-lease-id"]=a.proposedLeaseId}return b},listContainers:function(g,f,b){var c="/",h="GET";if(!g){g={}}g=Ext.apply(g,{comp:"list"});var a=this._formatRequestUrl(c,g);var e="";var d=this._formatRequest({url:a,method:h,xmlData:e,success:f,failure:b},c,g);this._sendRequest(d)},createContainer:function(e,i,d){var c="/"+e.container,a="PUT",f={restype:"container"};var b=this._formatRequestUrl(c,f);var h="";var g=this._formatRequest({url:b,method:a,xmlData:h,success:i,failure:d},c,f);this._sendRequest(g)},leaseContainer:function(f,e,j,d){var c="/"+f.container,a="PUT",g={restype:"container",comp:"lease"};var b=this._formatRequestUrl(c,g);var i="";e=e||{};e=this._setLeaseHeaders(f,e);var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:j,failure:d},c,g);this._sendRequest(h)},deleteContainer:function(f,j,d){var c="/"+f.container,a="DELETE",g={restype:"container"};var b=this._formatRequestUrl(c,g);var i="";var e={};if(f.leaseId){e["x-ms-lease-id"]=f.leaseId}var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:j,failure:d},c,g);this._sendRequest(h)},getContainerProperties:function(f,j,d){var c="/"+f.container,a="GET",g={restype:"container"};var b=this._formatRequestUrl(c,g);var i="";var e={};if(f.leaseId){e["x-ms-lease-id"]=f.leaseId}var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:j,failure:d},c,g);this._sendRequest(h)},getContainerMetaData:function(f,j,d){var c="/"+f.container,a="GET",g={restype:"container",comp:"metadata"};var b=this._formatRequestUrl(c,g);var i="";var e={};if(f.leaseId){e["x-ms-lease-id"]=f.leaseId}var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:j,failure:d},c,g);this._sendRequest(h)},setContainerMetaData:function(f,e,j,d){var c="/"+f.container,a="PUT",g={restype:"container",comp:"metadata"};var b=this._formatRequestUrl(c,g);var i="";var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:j,failure:d},c,g);this._sendRequest(h)},getContainerAcl:function(f,j,d){var c="/"+f.container,a="GET",g={restype:"container",comp:"acl"};var b=this._formatRequestUrl(c,g);var i="";var e={};if(f.leaseId){e["x-ms-lease-id"]=f.leaseId}var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:j,failure:d},c,g);this._sendRequest(h)},setContainerAcl:function(f,j,e,k,d){var c="/"+f.container,a="PUT",g={restype:"container",comp:"acl"};var b=this._formatRequestUrl(c,g);var i=this._applyXmlDocumentTpl(this.xmlDocumentTpl.acl,j);e=e||{};var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:k,failure:d},c,g);this._sendRequest(h)},listBlobs:function(e,f,i,d){var c="/"+e.container,a="GET";if(!f){f={}}f=Ext.apply(f,{restype:"container",comp:"list"});var b=this._formatRequestUrl(c,f);var h="";var g=this._formatRequest({url:b,method:a,xmlData:h,success:i,failure:d},c,f);this._sendRequest(g)},setPageBlob:function(f,e,j,d){var c="/"+f.container+"/"+f.blobName,a="PUT",g={};var b=this._formatRequestUrl(c,g);var i="";e=e||{};Ext.apply(e,{"x-ms-blob-type":"PageBlob","x-ms-blob-content-length":f.blobContentLength});var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:j,failure:d},c,g);this._sendRequest(h)},setBlockBlob:function(f,e,j,d){var c="/"+f.container+"/"+f.blobName,a="PUT",g={};var b=this._formatRequestUrl(c,g);var i=f.blobContent||"";e=e||{};e=Ext.apply({"x-ms-blob-type":"BlockBlob","x-ms-blob-public-access":(f.publicAccessLevel===""||f.publicAccessLevel===null||f.publicAccessLevel===undefined)?undefined:f.publicAccessLevel},e);var h=this._formatRequest({url:b,method:a,headers:e,xmlData:this._isBlob(i)?undefined:i,binaryData:this._isBlob(i)?i:undefined,success:j,failure:d},c,g);this._sendRequest(h)},getBlob:function(f,e,j,d){var c="/"+f.container+"/"+f.blobName,a="GET",g={};var b=this._formatRequestUrl(c,g);var i="";var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:j,failure:d,xhr2:true,responseType:f.responseType},c,g);this._sendRequest(h)},deleteBlob:function(f,e,j,d){var c="/"+f.container+"/"+f.blobName,a="DELETE",g={};var b=this._formatRequestUrl(c,g);var i="";var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:j,failure:d},c,g);this._sendRequest(h)},leaseBlob:function(f,e,j,d){var c="/"+f.container+"/"+f.blobName,a="PUT",g={comp:"lease"};var b=this._formatRequestUrl(c,g);var i="";e=e||{};e=this._setLeaseHeaders(f,e);var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:j,failure:d},c,g);this._sendRequest(h)},copyBlob:function(f,e,j,d){var c="/"+f.container+"/"+f.blobName,a="PUT",g={};var b=this._formatRequestUrl(c,g);var i="";e=e||{};e["x-ms-copy-source"]=f.url;var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:j,failure:d},c,g);this._sendRequest(h)},getBlobSnapshot:function(f,e,j,d){var c="/"+f.container+"/"+f.blobName,a="PUT",g={comp:"snapshot"};var b=this._formatRequestUrl(c,g);var i="";var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:j,failure:d},c,g);this._sendRequest(h)},abortBlobCopy:function(f,j,d){var c="/"+f.container+"/"+f.blobName,a="PUT",g={comp:"copy",copyid:f.copyId};var b=this._formatRequestUrl(c,g);var i="";var e={"x-ms-copy-action":"abort"};if(f.leaseId){e["x-ms-lease-id"]=f.leaseId}var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:j,failure:d},c,g);this._sendRequest(h)},putBlock:function(f,e,j,d){var c="/"+f.container+"/"+f.blobName,a="PUT",g={comp:"block",blockid:window.btoa(f.blockId)};var b=this._formatRequestUrl(c,g);var i=f.blockContent;var h=this._formatRequest({url:b,method:a,headers:e,xmlData:this._isBlob(i)?undefined:i,binaryData:this._isBlob(i)?i:undefined,success:j,failure:d},c,g);this._sendRequest(h)},putBlockList:function(f,j,e,k,d){var c="/"+f.container+"/"+f.blobName,a="PUT",g={comp:"blocklist"};var b=this._formatRequestUrl(c,g);var i=this._applyXmlDocumentTpl(this.xmlDocumentTpl.blocklist,j);var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:k,failure:d},c,g);this._sendRequest(h)},getBlockList:function(f,g,e,j,d){var c="/"+f.container+"/"+f.blobName,a="GET";if(!g){g={}}g=Ext.apply(g,{comp:"blocklist"});var b=this._formatRequestUrl(c,g);var i="";var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:j,failure:d},c,g);this._sendRequest(h)},putPage:function(f,e,j,d){var c="/"+f.container+"/"+f.blobName,a="PUT",g={comp:"page"};var b=this._formatRequestUrl(c,g);var i=(f.operation==="update")?f.blobContent:"";e=e||{};e=this._setRangeHeader(e,f.rangeStart,f.rangeEnd);e=Ext.apply({"x-ms-page-write":f.operation,"Content-Type":"application/octet-stream"},e);var h=this._formatRequest({url:b,method:a,headers:e,xmlData:this._isBlob(i)?undefined:i,binaryData:this._isBlob(i)?i:undefined,success:j,failure:d},c,g);this._sendRequest(h)},getPageRanges:function(f,e,j,d){var c="/"+f.container+"/"+f.blobName,a="GET",g={comp:"pagelist"};if(f.snapshotId){g.snapshot=f.snapshotId}var b=this._formatRequestUrl(c,g);var i="";e=e||{};e=this._setRangeHeader(e,f.rangeStart,f.rangeEnd);var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:j,failure:d},c,g);this._sendRequest(h)},getBlobMetaData:function(f,j,d){var c="/"+f.container+"/"+f.blobName,a="GET",g={comp:"metadata"};var b=this._formatRequestUrl(c,g);var i="";var e={};if(f.leaseId){e["x-ms-lease-id"]=f.leaseId}var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:j,failure:d},c,g);this._sendRequest(h)},setBlobMetaData:function(f,e,j,d){var c="/"+f.container+"/"+f.blobName,a="PUT",g={comp:"metadata"};var b=this._formatRequestUrl(c,g);var i="";var h=this._formatRequest({url:b,method:a,headers:e,xmlData:i,success:j,failure:d},c,g);this._sendRequest(h)}});Ext.define("Ext.azure.Azure",{mixins:["Ext.mixin.Observable"],singleton:true,version:"1.0.0.180.20140903154215",requires:["Ext.azure.Authentication","Ext.azure.Proxy","Ext.azure.storage.Table","Ext.azure.storage.Blob"],currentUser:null,config:{appUrl:null,appKey:null,protocol:"http",authIdentities:[]},constructor:function(a){this.initConfig(a);return this},init:function(a){if(!a.appUrl||!a.appKey){return false}this.setConfig(a);Ext.azure.Authentication.init();return true},buildDomainUrl:function(){return this.getProtocol()+"://"+Ext.Azure.getAppUrl()+"/"},getCurrentUser:function(){return Ext.azure.Authenication.getCurrentUser()},invokeApi:function(a){var b=this,d=b.getDefaultHeaders();if(a.useHeaderAuthentication){var c=Ext.azure.Authentication.getCurrentUser();if(typeof c!=="boolean"){d["X-ZUMO-AUTH"]=c.get("token")}else{return false}}Ext.Ajax.request(Ext.applyIf({url:b.buildDomainUrl()+"/api/"+a.apiName,method:a.method.toUpperCase(),headers:d,jsonData:a.jsonData,disableCachingParam:"cachebuster",success:Ext.bind(a.success||Ext.emptyFn,a.scope||this),failure:Ext.bind(a.failure||Ext.emptyFn,a.scope||this)},a))},getUserAgentString:function(){var a=Ext.Azure.version,b=Ext.create("Ext.XTemplate",[" ZUMO/{0} (lang={1}; os={2}; os_version={3}; arch={4}; version={5})"]);return navigator.userAgent+b.apply({0:a.substr(0,a.lastIndexOf(".")),1:"Sencha",2:"",3:"",4:"Neutral",5:a})},getDefaultHeaders:function(){return{"X-ZUMO-APPLICATION":this.getAppKey(),"X-ZUMO-VERSION":this.getUserAgentString()}}},function(){Ext.Azure=this});Ext.define("Ext._azure_touch.Push",{singleton:true,requires:["Ext.device.Push"],token:null,platform:null,config:{android:null,ios:null,windowsphone:null},init:function(a){if(a){this.setConfig(a)}this.platform=Ext.os.name;if(!Ext.os.is.Desktop){this.setup()}},setup:function(){var a=this,b={scope:a,type:Ext.device.Push.ALERT,success:a.registrationSuccessHandler,failure:a.errorHandler,received:a.notificationHandler};switch(Ext.os.name){case"iOS":if(a.getIos()){Ext.device.Push.register(b)}break;case"WindowsPhone":if(a.getWindowsphone()){Ext.device.Push.register(Ext.apply(b,{channelName:a.getWindowsphone()}))}break;case"Android":if(a.getAndroid()){Ext.device.Push.register(Ext.apply(b,{senderID:a.getAndroid()}))}break;default:break}},registrationSuccessHandler:function(a){switch(Ext.os.name){case"iOS":this.token=a;break;case"WindowsPhone":this.token=a.uri;break;case"Android":this.token=a.regid;break;default:break}Ext.Azure.fireEvent("pushregistrationsuccess",a)},errorHandler:function(a){Ext.Azure.fireEvent("pushregistrationfailure",a)},notificationHandler:function(a){if(Ext.os.is("Android")){if(a.event==="registered"&&a.regid.length>0){this.registrationSuccessHandler(a);return}}Ext.Azure.fireEvent("pushnotification",a)}},function(){Ext.azure.Push=this});Ext.define("Ext._azure_touch.AuthOptions",{extend:"Ext.Panel",requires:["Ext.Button"],hideOnMaskTap:true,modal:true,initialize:function(){var e=this,d=0,c=Ext.Azure.getAuthIdentities(),a=c.length,b=[];for(d;d<a;d++){switch(c[d].toLowerCase()){case"microsoft":b.push({xtype:"button",text:"Microsoft",handler:Ext.Function.bind(e.microsoftHandler,e)});break;case"facebook":b.push({xtype:"button",text:"Facebook",handler:Ext.Function.bind(e.facebookHandler,e)});break;case"google":b.push({xtype:"button",text:"Google",handler:Ext.Function.bind(e.googleHandler,e)});break;case"twitter":b.push({xtype:"button",text:"Twitter",handler:Ext.Function.bind(e.twitterHandler,e)});break}}if(b.length>0){e.setItems(b)}e.callParent()},microsoftHandler:function(){Ext.azure.Authentication.login("microsoftaccount");this.destroy()},facebookHandler:function(){Ext.azure.Authentication.login("facebook");this.destroy()},googleHandler:function(){Ext.azure.Authentication.login("google");this.destroy()},twitterHandler:function(){Ext.azure.Authentication.login("twitter");this.destroy()}},function(){Ext.azure.AuthOptions=this});Ext.define("Ext._azure_touch.User",{extend:"Ext.data.Model",requires:["Ext.data.proxy.LocalStorage"],config:{fields:[{name:"id",type:"string"},{name:"token",type:"string"},{name:"authMethod",type:"string"}],proxy:{type:"localstorage",id:"azure-user"}}},function(){Ext.azure.User=this});Ext.define("Ext.azure.override.Azure",{override:"Ext.azure.Azure",requires:["Ext.azure.Authentication","Ext.azure.Proxy","Ext._azure_touch.Push","Ext._azure_touch.AuthOptions","Ext._azure_touch.User","Ext.azure.storage.Table","Ext.azure.storage.Blob"],init:function(a){this.callParent([a]);if(this.getPushConfig()){Ext.azure.Push.init(this.getPushConfig())}return true}},function(){Ext.apply(this.config,{pushConfig:null});Ext.apply(this,{getPushConfig:function(){return this.config.pushConfig},setPushConfig:function(a){this.config.pushConfig=a}})});Ext.define("Ext.azure.Controller",{extend:"Ext.app.Controller",requires:["Ext.azure.Azure"],init:function(){var b=Ext.azure.Azure,a=this.getApplication().config.azure;this.getApplication().azure=this;b.init(a)}});Ext.define("Ext.azure.Store",{extend:"Ext.data.Store",alias:"store.azure",requires:["Ext.azure.Proxy"]});Ext.define("Ext.azure.override.JsonReader",{requires:"Ext.data.reader.Json"},function(){if(Ext.getVersion().isLessThan("2.3")){Ext.override(Ext.data.reader.Json,{process:function(a){if(a.status===204){return new Ext.data.ResultSet({total:0,count:0,records:[],success:true})}return this.callParent(arguments)}})}});